curl --location 'http://localhost:8080/api/workflows' \
--header 'Content-Type: application/json' \
--data-raw '{
  "name": "compliance-transaction-monitoring",
  "description": "Automated workflow to detect anomalies and compliance issues in transactions using Ollama AI",
  "nodes": [
    {
      "key": "scheduled-trigger",
      "type": "INPUT",
      "displayName": "Scheduled Trigger",
      "config": {
        "defaults": {}
      }
    },
    {
      "key": "fetch-transactions",
      "type": "HTTP",
      "displayName": "Fetch Transactions",
      "config": {
        "url": "https://31q3g.wiremockapi.cloud/dummy/transactions",
        "method": "GET",
        "headers": {
          "Content-Type": "application/json"
        }
      }
    },
    {
      "key": "detect-anomalies",
      "type": "OLLAMA",
      "displayName": "Detect Anomalies or Compliance Issues",
      "config": {
        "model": "gemma3:1b",
        "prompt": "Analyze the following transaction data for suspicious activities, anomalies, or compliance issues. Look for unusual patterns, high-value transactions, transactions to sanctioned entities, or any red flags. Respond with ONLY the word \"true\" if you find ANY suspicious activities, anomalies, or compliance issues, or ONLY the word \"false\" if everything looks normal. Do not include any other text. Transaction data: {{fetch-transactions::body}}"
      }
    },
    {
      "key": "get-analysis-details",
      "type": "OLLAMA",
      "displayName": "Get Detailed Analysis",
      "config": {
        "model": "gemma3:1b",
        "prompt": "Provide a detailed analysis of the following transaction data. Identify any suspicious activities, anomalies, or compliance issues. Include specific details about unusual patterns, high-value transactions, transactions to sanctioned entities, or any red flags. Transaction data: {{fetch-transactions::body}}"
      }
    },
    {
      "key": "flag-suspicious",
      "type": "IF_ELSE",
      "displayName": "Flag Suspicious Activities",
      "config": {
        "condition": "{{detect-anomalies::response}} == \"true\""
      }
    },
    {
      "key": "generate-report",
      "type": "SCRIPT_JS",
      "displayName": "Generate Compliance Report",
      "config": {
        "script": "const now = new Date().toISOString();\nconst transactions = context['fetch-transactions']?.body || 'N/A';\nconst analysis = context['get-analysis-details']?.response || context['detect-anomalies']?.response || 'N/A';\n\nconst report = `COMPLIANCE ALERT REPORT\n\nDate: ${now}\n\nTransactions Analyzed:\n${transactions}\n\nAI Analysis Results:\n${analysis}\n\nStatus: SUSPICIOUS ACTIVITY DETECTED\n\nAction Required: Immediate review by compliance team\n\n---\nGenerated by Compliance Monitoring System\n`;\n\nreturn { report: report, timestamp: now, status: 'ALERT' };"
      }
    },
    {
      "key": "send-alert",
      "type": "EMAIL",
      "displayName": "Alert Compliance Team",
      "config": {
        "to": "compliance@yourcompany.com",
        "subject": "URGENT: Suspicious Transaction Activity Detected",
        "body": "{{generate-report::report}}",
        "from": "alerts@yourcompany.com"
      }
    },
    {
      "key": "no-action-output",
      "type": "OUTPUT",
      "displayName": "No Action Required",
      "config": {
        "fields": ["fetch-transactions", "detect-anomalies"]
      }
    },
    {
      "key": "workflow-end",
      "type": "OUTPUT",
      "displayName": "Workflow Complete",
      "config": {
        "fields": ["fetch-transactions", "detect-anomalies", "get-analysis-details", "generate-report", "send-alert"]
      }
    }
  ],
  "edges": [
    {
      "sourceKey": "scheduled-trigger",
      "targetKey": "fetch-transactions"
    },
    {
      "sourceKey": "fetch-transactions",
      "targetKey": "detect-anomalies"
    },
    {
      "sourceKey": "detect-anomalies",
      "targetKey": "flag-suspicious"
    },
    {
      "sourceKey": "flag-suspicious",
      "targetKey": "get-analysis-details",
      "conditionExpression": "true"
    },
    {
      "sourceKey": "get-analysis-details",
      "targetKey": "generate-report"
    },
    {
      "sourceKey": "flag-suspicious",
      "targetKey": "no-action-output",
      "conditionExpression": "false"
    },
    {
      "sourceKey": "generate-report",
      "targetKey": "send-alert"
    },
    {
      "sourceKey": "send-alert",
      "targetKey": "workflow-end"
    },
    {
      "sourceKey": "no-action-output",
      "targetKey": "workflow-end"
    }
  ]
}'

